<script>
const gate = document.getElementById("gate");
const center = document.querySelector(".center");

const canvas = document.getElementById("bg");
const ctx = canvas.getContext("2d");

let stars = [];
let animationId;

// force proper resize
function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function createStars(){
  stars = [];
  const count = window.innerWidth < 768 ? 1200 : 3500;

  for(let i=0;i<count;i++){
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      speed: Math.random() * 0.6 + 0.2,
      size: Math.random() * 1.2 + 0.3
    });
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "white";

  stars.forEach(star=>{
    star.y += star.speed;

    if(star.y > canvas.height){
      star.y = 0;
      star.x = Math.random() * canvas.width;
    }

    ctx.globalAlpha = 0.6;
    ctx.fillRect(star.x, star.y, star.size, star.size);
  });

  ctx.globalAlpha = 1;
  animationId = requestAnimationFrame(draw);
}

function init(){
  resize();
  createStars();
  cancelAnimationFrame(animationId);
  draw();
}

// IMPORTANT: delay canvas start slightly to avoid Safari black frame bug
window.addEventListener("load", () => {
  setTimeout(init, 100);
});

window.addEventListener("resize", init);

// gate animation
gate.addEventListener("click",()=>{
  gate.classList.add("fold");

  setTimeout(()=>{
    gate.style.display="none";
    center.style.opacity="1";

    // reinitialize AFTER overlay disappears (Safari fix)
    init();
  },900);
});
</script>
